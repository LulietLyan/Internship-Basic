---
statistics: true
comments: true
---

<style>
body {
  position: relative; /* ç¡®ä¿ body å…ƒç´ çš„ position å±æ€§ä¸ºéé™æ€å€¼ */
}

body::before {
  --size: 35px; /* è°ƒæ•´ç½‘æ ¼å•å…ƒå¤§å° */
  --line: color-mix(in hsl, canvasText, transparent 80%); /* è°ƒæ•´çº¿æ¡é€æ˜åº¦ */
  content: '';
  height: 100vh;
  width: 100%;
  position: absolute; /* ä¿®æ”¹ä¸º absolute ä»¥ä½¿å…¶éšé¡µé¢æ»šåŠ¨ */
  background: linear-gradient(
        90deg,
        var(--line) 1px,
        transparent 1px var(--size)
      )
      50% 50% / var(--size) var(--size),
    linear-gradient(var(--line) 1px, transparent 1px var(--size)) 50% 50% /
      var(--size) var(--size);
  -webkit-mask: linear-gradient(-20deg, transparent 50%, white);
          mask: linear-gradient(-20deg, transparent 50%, white);
  top: 0;
  transform-style: flat;
  pointer-events: none;
  z-index: -1;
}

@media (max-width: 768px) {
  body::before {
    display: none; /* åœ¨æ‰‹æœºç«¯éšè—ç½‘æ ¼æ•ˆæœ */
  }
}
</style>

# ğŸ”µ ç´¢å¼•

## MySQL ä¸ºä»€ä¹ˆä½¿ç”¨ B+ æ ‘æ¥ä½œç´¢å¼•ï¼Œå®ƒçš„ä¼˜åŠ¿ä»€ä¹ˆï¼Ÿ

### ç‰¹æ€§å’Œå®šä¹‰

B+ Tree æ˜¯ä¸€ç§å¤šå‰æ ‘ï¼Œ **å¶å­èŠ‚ç‚¹æ‰å­˜æ”¾æ•°æ®ï¼Œéå¶å­èŠ‚ç‚¹åªå­˜æ”¾ç´¢å¼•**ï¼Œæ¯ä¸ªèŠ‚ç‚¹é‡Œçš„æ•°æ®æ˜¯æŒ‰ä¸»é”®é¡ºåºå­˜æ”¾çš„ã€‚åœ¨å¶å­èŠ‚ç‚¹ä¸­ï¼ŒåŒ…æ‹¬äº†æ‰€æœ‰çš„ç´¢å¼•å€¼ä¿¡æ¯ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹éƒ½æŒ‡å‘ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼Œå½¢æˆä¸€ä¸ªé“¾è¡¨ã€‚B+ Tree å­˜å‚¨åƒä¸‡çº§çš„æ•°æ®åªéœ€è¦ 3-4 å±‚é«˜åº¦å°±å¯ä»¥æ»¡è¶³ï¼Œåƒä¸‡çº§çš„è¡¨æŸ¥è¯¢ç›®æ ‡æ•°æ®æœ€å¤šéœ€è¦ 3-4 æ¬¡ç¡¬ç›˜ I/Oã€‚

### B+ æ ‘å’Œ B æ ‘ç›¸æ¯”ï¼š

- **B+ æ ‘æ‰€æœ‰å…³é”®ç éƒ½å­˜æ”¾åœ¨å¶èŠ‚ç‚¹ä¸­**ï¼Œä¸Šå±‚çš„éå¶èŠ‚ç‚¹çš„å…³é”®ç æ˜¯å…¶å­æ ‘ä¸­æœ€å°å…³é”®ç çš„å¤å†™
- **B+ æ ‘å¶èŠ‚ç‚¹åŒ…å«äº†å…¨éƒ¨å…³é”®ç åŠæŒ‡å‘ç›¸åº”æ•°æ®è®°å½•å­˜æ”¾åœ°å€çš„æŒ‡é’ˆ**ï¼Œä¸”å¶èŠ‚ç‚¹æœ¬èº«æŒ‰å…³é”®ç ä»å°åˆ°å¤§é¡ºåºè¿æ¥
- B+ æ ‘åœ¨æœç´¢è¿‡ç¨‹ä¸­ï¼Œ **å¦‚æœæŸ¥è¯¢å’Œå†…éƒ¨èŠ‚ç‚¹çš„å…³é”®å­—ä¸€è‡´ï¼Œé‚£ä¹ˆæœç´¢è¿‡ç¨‹ä¸åœæ­¢ï¼Œè€Œæ˜¯ç»§ç»­å‘ä¸‹æœç´¢è¿™ä¸ªåˆ†æ”¯** 

### ä¼˜åŠ¿

- **å•ç‚¹æŸ¥è¯¢**ï¼šB æ ‘è¿›è¡Œå•ä¸ªç´¢å¼•æŸ¥è¯¢æ—¶ï¼Œæœ€å¿«å¯ä»¥åœ¨ O(1) çš„æ—¶é—´ä»£ä»·å†…å°±æŸ¥åˆ°ã€‚ä»å¹³å‡æ—¶é—´ä»£ä»·æ¥çœ‹ï¼Œ **ä¼šæ¯” B+ æ ‘ç¨å¿«ä¸€äº›**ã€‚ä½†æ˜¯  **B æ ‘çš„æŸ¥è¯¢æ³¢åŠ¨ä¼šæ¯”è¾ƒå¤§**ï¼Œå› ä¸ºæ¯ä¸ªèŠ‚ç‚¹å³å­˜ç´¢å¼•åˆå­˜è®°å½•ï¼Œæ‰€ä»¥æœ‰æ—¶å€™è®¿é—®åˆ°äº†éå¶å­èŠ‚ç‚¹å°±å¯ä»¥æ‰¾åˆ°ç´¢å¼•ï¼Œè€Œæœ‰æ—¶éœ€è¦è®¿é—®åˆ°å¶å­èŠ‚ç‚¹æ‰èƒ½æ‰¾åˆ°ç´¢å¼•ã€‚B+ æ ‘çš„éå¶å­èŠ‚ç‚¹ä¸å­˜æ”¾å®é™…çš„è®°å½•æ•°æ®ï¼Œä»…å­˜æ”¾ç´¢å¼•ï¼Œæ•°æ®é‡ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒB+ æ ‘çš„éå¶å­èŠ‚ç‚¹å¯ä»¥å­˜æ”¾æ›´å¤šçš„ç´¢å¼•ï¼ŒæŸ¥è¯¢åº•å±‚èŠ‚ç‚¹çš„ **ç¡¬ç›˜ I/O æ¬¡æ•°ä¼šæ›´å°‘** 
- **æ’å…¥å’Œåˆ é™¤æ•ˆç‡**ï¼šB+ æ ‘æœ‰å¤§é‡çš„å†—ä½™èŠ‚ç‚¹ï¼Œåˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥ä»å¶å­èŠ‚ç‚¹ä¸­åˆ é™¤ï¼Œç”šè‡³å¯ä»¥ä¸åŠ¨éå¶å­èŠ‚ç‚¹ï¼Œåˆ é™¤éå¸¸å¿«ã€‚B+ æ ‘çš„æ’å…¥ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæœ‰å†—ä½™èŠ‚ç‚¹ï¼Œæ’å…¥å¯èƒ½å­˜åœ¨èŠ‚ç‚¹çš„åˆ†è£‚(å¦‚æœèŠ‚ç‚¹é¥±å’Œ)ï¼Œä½†æ˜¯æœ€å¤šåªæ¶‰åŠæ ‘çš„ä¸€æ¡è·¯å¾„ã€‚B æ ‘æ²¡æœ‰å†—ä½™èŠ‚ç‚¹ï¼Œæ’å…¥æˆ–åˆ é™¤èŠ‚ç‚¹çš„æ—¶å€™éå¸¸å¤æ‚ï¼Œå¯èƒ½æ¶‰åŠå¤æ‚çš„æ ‘çš„å˜å½¢
- **èŒƒå›´æŸ¥è¯¢**ï¼šB+ æ ‘æ‰€æœ‰å¶å­èŠ‚ç‚¹é—´æœ‰ä¸€ä¸ªé“¾è¡¨è¿›è¡Œè¿æ¥ï¼Œè€Œ B æ ‘æ²¡æœ‰å°†æ‰€æœ‰å¶å­èŠ‚ç‚¹ç”¨é“¾è¡¨ä¸²è”èµ·æ¥çš„ç»“æ„ï¼Œå› æ­¤åªèƒ½é€šè¿‡æ ‘çš„éå†æ¥å®ŒæˆèŒƒå›´æŸ¥è¯¢ï¼Œ **èŒƒå›´æŸ¥è¯¢æ•ˆç‡ä¸å¦‚ B+ æ ‘**ã€‚B+ æ ‘çš„æ’å…¥å’Œåˆ é™¤èŒƒå›´æŸ¥è¯¢æ•ˆç‡æ›´é«˜ã€‚å­˜åœ¨å¤§é‡èŒƒå›´æ£€ç´¢çš„åœºæ™¯é€‚åˆä½¿ç”¨ B+ æ ‘ï¼Œæ¯”å¦‚æ•°æ®åº“ã€‚è€Œå¯¹äºå¤§é‡çš„å•ä¸ªç´¢å¼•æŸ¥è¯¢çš„åœºæ™¯å¯ä»¥è€ƒè™‘ B æ ‘ï¼Œæ¯”å¦‚ nosql çš„ MongoDB

### å¯¹æ¯”

- **B+ Tree å¯¹æ¯” B Tree**ï¼šB+Tree åªåœ¨å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®ï¼Œè€Œ B æ ‘ çš„éå¶å­èŠ‚ç‚¹ä¹Ÿè¦å­˜å‚¨æ•°æ®ï¼Œæ‰€ä»¥ B+Tree çš„å•ä¸ªèŠ‚ç‚¹çš„æ•°æ®é‡æ›´å°ï¼Œåœ¨ç›¸åŒçš„ç¡¬ç›˜ I/O æ¬¡æ•°ä¸‹ï¼Œå°±èƒ½æŸ¥è¯¢æ›´å¤šçš„èŠ‚ç‚¹ã€‚B+ Tree å¶å­èŠ‚ç‚¹é‡‡ç”¨çš„æ˜¯åŒé“¾è¡¨è¿æ¥ï¼Œé€‚åˆ MySQL ä¸­å¸¸è§çš„åŸºäºèŒƒå›´çš„é¡ºåºæŸ¥æ‰¾ï¼Œè€Œ B æ ‘æ— æ³•åšåˆ°è¿™ä¸€ç‚¹
- **B+ Tree å¯¹æ¯” äºŒå‰æ ‘**ï¼šå¯¹äºæœ‰ N ä¸ªå¶å­èŠ‚ç‚¹çš„ B+ Treeï¼Œ **å…¶æœç´¢å¤æ‚åº¦ä¸º $O(log_dN)$**ï¼Œå…¶ä¸­ d è¡¨ç¤ºèŠ‚ç‚¹å…è®¸çš„æœ€å¤§å­èŠ‚ç‚¹ä¸ªæ•°ã€‚åœ¨å®é™…çš„åº”ç”¨å½“ä¸­ï¼Œ d å€¼æ˜¯å¤§äº 100 çš„ï¼Œå³ä½¿æ•°æ®è¾¾åˆ°åƒä¸‡çº§åˆ«æ—¶ï¼ŒB+ Tree çš„é«˜åº¦ä¾ç„¶ç»´æŒåœ¨ 3~4 å±‚å·¦å³ï¼Œä¸€æ¬¡æ•°æ®æŸ¥è¯¢æ“ä½œåªéœ€è¦åš 3~4 æ¬¡çš„ç¡¬ç›˜ I/O æ“ä½œå°±èƒ½æŸ¥è¯¢åˆ°ã€‚äºŒå‰æ ‘çš„æ¯ä¸ªçˆ¶èŠ‚ç‚¹çš„å„¿å­èŠ‚ç‚¹ä¸ªæ•°æ˜¯ 2 ä¸ªï¼Œæ„å‘³ç€ **å…¶æœç´¢å¤æ‚åº¦ä¸º $O(log_2N)$**ï¼ŒäºŒå‰æ ‘æ£€ç´¢åˆ°ç›®æ ‡æ•°æ®æ‰€ç»å†çš„ **ç¡¬ç›˜ I/O æ¬¡æ•°è¦æ›´å¤š** 
- **B+ Tree å¯¹æ¯” Hash**ï¼šHash åœ¨åšç­‰å€¼æŸ¥è¯¢çš„æ—¶å€™æ•ˆç‡é«˜ï¼Œæœç´¢å¤æ‚åº¦ä¸º O(1)ã€‚ä½†æ˜¯  **Hash è¡¨ä¸é€‚åˆåšèŒƒå›´æŸ¥è¯¢** 

## ç´¢å¼•æœ‰å“ªäº›ç§ç±»ï¼Ÿ

- **å•å€¼ç´¢å¼•**ï¼šå³ä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•åˆ—ç´¢å¼•
  - å»ºè¡¨æ—¶åŠ ä¸Š  **key(åˆ—å)**  æŒ‡å®š
  - å•ç‹¬åˆ›å»ºï¼š **create index ç´¢å¼•å on è¡¨å(åˆ—å)** 
  - å•ç‹¬åˆ›å»ºï¼š **alter table è¡¨å add index ç´¢å¼•å(åˆ—å)** 
- **å”¯ä¸€ç´¢å¼•**ï¼šç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½† **å…è®¸æœ‰ null ä¸” null å¯ä»¥å‡ºç°å¤šæ¬¡** 
  - å»ºè¡¨æ—¶åŠ ä¸Š  **unique(åˆ—å)**  æŒ‡å®š
  - å•ç‹¬åˆ›å»ºï¼š **create unique index idx è¡¨å(åˆ—å) on è¡¨å(åˆ—å)** 
  - å•ç‹¬åˆ›å»ºï¼š **alter table è¡¨å add unique ç´¢å¼•å(åˆ—å)** 
- **ä¸»é”®ç´¢å¼•**ï¼šè®¾å®šä¸ºä¸»é”®åæ•°æ®åº“ä¼šè‡ªåŠ¨å»ºç«‹ç´¢å¼•ï¼Œinnodb ä¸ºèšç°‡ç´¢å¼•ï¼Œå€¼ **å¿…é¡»å”¯ä¸€ä¸”ä¸èƒ½ä¸º null** 
  - å»ºè¡¨æ—¶åŠ ä¸Š  **primary key(åˆ—å)**  æŒ‡å®š
- **å¤åˆç´¢å¼•**ï¼šå³ä¸€ä¸ªç´¢å¼•åŒ…å«å¤šä¸ªåˆ—
  - å»ºè¡¨æ—¶åŠ ä¸Š  **key(åˆ—ååˆ—è¡¨)**  æŒ‡å®š
  - å•ç‹¬åˆ›å»ºï¼š **create index ç´¢å¼•å on è¡¨å(åˆ—ååˆ—è¡¨)** 
  - å•ç‹¬åˆ›å»ºï¼š **alter table è¡¨å add index ç´¢å¼•å(åˆ—ååˆ—è¡¨)** 
- **å‰ç¼€ç´¢å¼•**ï¼šå¯¹å­—ç¬¦ç±»å‹å­—æ®µçš„å‰å‡ ä¸ªå­—ç¬¦å»ºç«‹çš„ç´¢å¼•ï¼Œè€Œä¸æ˜¯åœ¨æ•´ä¸ªå­—æ®µä¸Šå»ºç«‹çš„ç´¢å¼•ï¼Œå‰ç¼€ç´¢å¼•å¯ä»¥å»ºç«‹åœ¨å­—æ®µç±»å‹ä¸º  **charã€ varcharã€binaryã€varbinary**  çš„åˆ—ä¸Šã€‚ä½¿ç”¨å‰ç¼€ç´¢å¼•çš„ç›®çš„æ˜¯ä¸ºäº†å‡å°‘ç´¢å¼•å ç”¨çš„å­˜å‚¨ç©ºé—´ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡
  - å•ç‹¬åˆ›å»ºï¼š **alter table è¡¨å add index ç´¢å¼•å(åˆ—å(ç´¢å¼•é•¿åº¦))** 

## ä»€ä¹ˆæ˜¯æœ€å·¦åŒ¹é…åŸåˆ™ï¼Ÿ

ä½¿ç”¨è”åˆç´¢å¼•æ—¶ï¼Œå­˜åœ¨æœ€å·¦åŒ¹é…åŸåˆ™ï¼Œä¹Ÿå°±æ˜¯æŒ‰ç…§æœ€å·¦ä¼˜å…ˆçš„æ–¹å¼è¿›è¡Œç´¢å¼•çš„åŒ¹é…ã€‚ä½¿ç”¨è”åˆç´¢å¼•è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œå¦‚æœä¸éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œè”åˆç´¢å¼•ä¼šå¤±æ•ˆã€‚

>  **ä»¥è”åˆç´¢å¼•(a, b, c)ä¸ºä¾‹** 
> 
> å› ä¸º (a, b, c) è”åˆç´¢å¼•æ˜¯å…ˆæŒ‰ a æ’åºï¼›åœ¨ a ç›¸åŒçš„æƒ…å†µå†æŒ‰ b æ’åºï¼›åœ¨ b ç›¸åŒçš„æƒ…å†µå†æŒ‰ c æ’åºã€‚æ‰€ä»¥  **b å’Œ c æ˜¯å…¨å±€æ— åºï¼Œå±€éƒ¨ç›¸å¯¹æœ‰åºçš„**ï¼Œè¿™æ ·åœ¨æ²¡æœ‰éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™çš„æƒ…å†µä¸‹ï¼Œæ˜¯æ— æ³•åˆ©ç”¨åˆ°ç´¢å¼•çš„ã€‚ **åˆ©ç”¨ç´¢å¼•çš„å‰ææ˜¯ç´¢å¼•é‡Œçš„ key æ˜¯æœ‰åºçš„** 
> 
> è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™åœ¨é‡åˆ°èŒƒå›´æŸ¥è¯¢(å¦‚ >ã€<)çš„æ—¶å€™åœæ­¢åŒ¹é…ï¼ŒèŒƒå›´æŸ¥è¯¢çš„å­—æ®µå¯ä»¥ç”¨åˆ°è”åˆç´¢å¼•ï¼Œåœ¨èŒƒå›´æŸ¥è¯¢å­—æ®µçš„åé¢çš„å­—æ®µæ— æ³•ç”¨åˆ°è”åˆç´¢å¼•ã€‚
> 
>  **æ³¨æ„**ï¼šå¯¹äº  **>=ã€<=ã€BETWEENã€like**  å‰ç¼€åŒ¹é…çš„èŒƒå›´æŸ¥è¯¢å¹¶ä¸ä¼šåœæ­¢åŒ¹é…

## ç´¢å¼•åŒºåˆ†åº¦ï¼Ÿ

æŸ¥è¯¢ä¼˜åŒ–å™¨å‘ç°æŸä¸ªå€¼å‡ºç°åœ¨è¡¨çš„æ•°æ®è¡Œä¸­çš„ç™¾åˆ†æ¯”(æƒ¯ç”¨çš„ç™¾åˆ†æ¯”ç•Œçº¿æ˜¯"30%")å¾ˆé«˜çš„æ—¶å€™ä¼šå¿½ç•¥ç´¢å¼•ï¼Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚

## è”åˆç´¢å¼•å¦‚ä½•è¿›è¡Œæ’åºï¼Ÿ

ç»™ç´¢å¼•åˆ—å’Œæ’åºåˆ—å»ºç«‹ä¸€ä¸ªè”åˆç´¢å¼•ï¼Œåœ¨æŸ¥è¯¢æ—¶æŸ¥åˆ°ä¸€ä¸ªç´¢å¼•ä¹‹åï¼Œè¿˜è¦å¯¹ create_time æ’åºï¼Œç”¨åˆ°æ–‡ä»¶æ’åº filesortã€‚åœ¨ SQL æ‰§è¡Œè®¡åˆ’ä¸­ï¼ŒExtra åˆ—ä¼šå‡ºç° Using filesortã€‚

å¯ä»¥åˆ©ç”¨ç´¢å¼•çš„æœ‰åºæ€§ï¼Œåœ¨æ’åºåˆ—å»ºç«‹è”åˆç´¢å¼•ï¼Œè¿™æ ·æ ¹æ® status ç­›é€‰åçš„æ•°æ®å°±æ˜¯æŒ‰ç…§ create_time æ’å¥½åºçš„ï¼Œé¿å…åœ¨æ–‡ä»¶æ’åºï¼Œæé«˜äº†æŸ¥è¯¢æ•ˆç‡ã€‚

## ä½¿ç”¨ç´¢å¼•ä¼šæœ‰å“ªäº›ç¼ºé™·ï¼Ÿ

è™½ç„¶ç´¢å¼•å¤§å¤§æé«˜äº†æŸ¥è¯¢é€Ÿåº¦ï¼ŒåŒæ—¶å´ä¼š **é™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦**ï¼Œå¦‚å¯¹è¡¨è¿›è¡Œ INSERTã€UPDATE å’Œ DELETEã€‚

å› ä¸ºæ›´æ–°è¡¨æ—¶ï¼ŒMySQL  **ä¸ä»…è¦ä¿å­˜æ•°æ®ï¼Œè¿˜è¦ä¿å­˜ç´¢å¼•æ–‡ä»¶æ¯æ¬¡æ›´æ–°æ·»åŠ äº†ç´¢å¼•åˆ—çš„å­—æ®µ**ï¼Œéƒ½ä¼šè°ƒæ•´å› ä¸ºæ›´æ–°æ‰€å¸¦æ¥çš„é”®å€¼å˜åŒ–åçš„ç´¢å¼•ä¿¡æ¯ã€‚

å®é™…ä¸Šç´¢å¼•ä¹Ÿæ˜¯ä¸€å¼ è¡¨ï¼Œè¯¥è¡¨ä¿å­˜äº†ä¸»é”®ä¸ç´¢å¼•å­—æ®µï¼Œå¹¶æŒ‡å‘å®ä½“è¡¨çš„è®°å½•ï¼Œæ‰€ä»¥ç´¢å¼•åˆ—ä¹Ÿæ˜¯è¦å ç”¨ç©ºé—´çš„ã€‚

## ä»€ä¹ˆæ—¶å€™éœ€è¦/ä¸éœ€è¦åˆ›å»ºç´¢å¼•ï¼Ÿ

### éœ€è¦åˆ›å»ºç´¢å¼•
- **è¡¨çš„ä¸»å…³é”®å­—**ï¼šè‡ªåŠ¨å»ºç«‹å”¯ä¸€ç´¢å¼•
- **è¡¨çš„å­—æ®µå”¯ä¸€çº¦æŸ**ï¼šåˆ©ç”¨ç´¢å¼•æ¥ä¿è¯æ•°æ®çš„å®Œæ•´
- **ç›´æ¥æ¡ä»¶æŸ¥è¯¢çš„å­—æ®µ**ï¼šç»å¸¸ç”¨äº WHERE æŸ¥è¯¢æ¡ä»¶çš„å­—æ®µï¼Œè¿™æ ·èƒ½å¤Ÿæé«˜æ•´ä¸ªè¡¨çš„æŸ¥è¯¢é€Ÿåº¦
- **æŸ¥è¯¢ä¸­ä¸å…¶å®ƒè¡¨å…³è”çš„å­—æ®µ**ï¼šä¾‹å¦‚å­—æ®µå»ºç«‹äº†å¤–é”®å…³ç³»
- **æŸ¥è¯¢ä¸­æ’åºçš„å­—æ®µ**ï¼šæ’åºçš„å­—æ®µå¦‚æœé€šè¿‡ç´¢å¼•å»è®¿é—®å°†å¤§å¤§æé«˜æ’åºé€Ÿåº¦
- **æŸ¥è¯¢ä¸­ç»Ÿè®¡æˆ–åˆ†ç»„ç»Ÿè®¡çš„å­—æ®µ**ï¼šç»å¸¸ç”¨äº GROUP BY å’Œ ORDER BY çš„å­—æ®µï¼Œå¯ä»¥åˆ›å»ºè”åˆç´¢å¼•

### ä¸éœ€è¦åˆ›å»ºç´¢å¼•

- **è¡¨è®°å½•å¤ªå°‘**ï¼šè¡¨æ•°æ®å¤ªå°‘çš„æ—¶å€™ï¼Œä¸éœ€è¦åˆ›å»ºç´¢å¼•
- **ç»å¸¸æ’å…¥ã€åˆ é™¤ã€ä¿®æ”¹çš„å­—æ®µ**ï¼šç»å¸¸æ›´æ–°çš„å­—æ®µä¸ç”¨åˆ›å»ºç´¢å¼•ï¼Œç´¢å¼•å­—æ®µé¢‘ç¹ä¿®æ”¹ï¼Œç”±äºè¦ç»´æŠ¤ B+ Tree çš„æœ‰åºæ€§ï¼Œé‚£ä¹ˆå°±éœ€è¦é¢‘ç¹çš„é‡å»ºç´¢å¼•ï¼Œä¼šå½±å“æ•°æ®åº“æ€§èƒ½
- **æ•°æ®é‡å¤ä¸”åˆ†å¸ƒå¹³å‡çš„è¡¨å­—æ®µ**ï¼šå‡å¦‚ä¸€ä¸ªè¡¨æœ‰10ä¸‡è¡Œè®°å½•ï¼Œæ€§åˆ«åªæœ‰ç”·å’Œå¥³ä¸¤ç§å€¼ï¼Œä¸”æ¯ä¸ªå€¼çš„åˆ†å¸ƒæ¦‚ç‡å¤§çº¦ä¸º50%ï¼Œé‚£ä¹ˆå¯¹è¿™ç§å­—æ®µå»ºç´¢å¼•ä¸€èˆ¬ä¸ä¼šæé«˜æ•°æ®åº“çš„æŸ¥è¯¢é€Ÿåº¦ã€‚
- **ç»å¸¸å’Œä¸»å­—æ®µä¸€å—æŸ¥è¯¢ä½†ä¸»å­—æ®µç´¢å¼•å€¼æ¯”è¾ƒå¤šçš„è¡¨å­—æ®µ** 

## ç´¢å¼•çš„ä¼˜åŒ–(ä½¿ç”¨ç´¢å¼•çš„æ³¨æ„äº‹é¡¹)ï¼Ÿ

- **like è¯­å¥çš„å‰å¯¼æ¨¡ç³ŠæŸ¥è¯¢ä¸èƒ½ä½¿ç”¨ç´¢å¼•** 
  ```sql
    select * from doc where title like '%XX';   --ä¸èƒ½ä½¿ç”¨ç´¢å¼•
    select * from doc where title like 'XX%';   --éå‰å¯¼æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¯ä»¥ä½¿ç”¨ç´¢å¼•
  ```
  unionã€inã€or éƒ½èƒ½å¤Ÿå‘½ä¸­ç´¢å¼•ï¼Œå»ºè®®ä½¿ç”¨ inï¼Œå› ä¸º in çš„ç»¼åˆæ•ˆç‡æœ€é«˜ã€‚
- **è´Ÿå‘æ¡ä»¶æŸ¥è¯¢ä¸èƒ½ä½¿ç”¨ç´¢å¼•** 
  è´Ÿå‘æ¡ä»¶æœ‰ï¼š!=ã€<>ã€not inã€not existsã€not like ç­‰ï¼Œä¼˜åŒ–æ¡ˆä¾‹ï¼š
  ```sql
  select * from doc where status != 1 and status != 2;  --ä¼˜åŒ–å‰
  select * from doc where status in (0,3,4);            --ä¼˜åŒ–å
  ```
- **è”åˆç´¢å¼•æœ€å·¦å‰ç¼€åŸåˆ™** 
  å¦‚æœåœ¨ (a, b, c) ä¸‰ä¸ªå­—æ®µä¸Šå»ºç«‹è”åˆç´¢å¼•ï¼Œé‚£ä¹ˆä»–ä¼šè‡ªåŠ¨å»ºç«‹ a| (a,b) | (a,b,c) ç»„ç´¢å¼•ã€‚
  - å»ºç«‹è”åˆç´¢å¼•çš„æ—¶å€™ï¼ŒåŒºåˆ†åº¦æœ€é«˜çš„å­—æ®µåœ¨æœ€å·¦è¾¹
  - å­˜åœ¨éç­‰å·å’Œç­‰å·æ··åˆåˆ¤æ–­æ¡ä»¶æ—¶ï¼Œåœ¨å»ºç«‹ç´¢å¼•æ—¶ï¼ŒæŠŠç­‰å·æ¡ä»¶çš„åˆ—å‰ç½®ã€‚å¦‚ where a>? and b=?ï¼Œé‚£ä¹ˆå³ä½¿ a  çš„åŒºåˆ†åº¦æ›´é«˜ï¼Œä¹Ÿå¿…é¡»æŠŠ b æ”¾åœ¨ç´¢å¼•çš„æœ€å‰åˆ—
  - æœ€å·¦å‰ç¼€æŸ¥è¯¢æ—¶ï¼Œå¹¶ä¸æ˜¯æŒ‡ SQL è¯­å¥çš„ where é¡ºåºè¦å’Œè”åˆç´¢å¼•ä¸€è‡´
- **ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸­èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—(èŒƒå›´åˆ—å¯ä»¥ç”¨åˆ°ç´¢å¼•)ï¼ŒèŒƒå›´åˆ—ä¹‹ååˆ—çš„ç´¢å¼•å…¨å¤±æ•ˆ** 
  - èŒƒå›´æ¡ä»¶æœ‰ï¼š<ã€<=ã€>ã€>=ã€between ç­‰
  - ç´¢å¼•æœ€å¤šç”¨äºä¸€ä¸ªèŒƒå›´åˆ—ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­æœ‰ä¸¤ä¸ªèŒƒå›´åˆ—åˆ™æ— æ³•å…¨ç”¨åˆ°ç´¢å¼•
  - å‡å¦‚æœ‰è”åˆç´¢å¼• (emp_noã€titleã€fromdate)ï¼Œé‚£ä¹ˆä¸‹é¢çš„ SQL ä¸­ emp_no å¯ä»¥ç”¨åˆ°ç´¢å¼•ï¼Œè€Œ title  å’Œ from_date åˆ™ä½¿ç”¨ä¸åˆ°ç´¢å¼•
  ```sql
    select * from employees.titles 
    where emp_no < 10010' and title='Senior Engineer' and 
    from_date between '1986-01-01' and '1986-12-31';
  ```
- **ä¸è¦åœ¨ç´¢å¼•åˆ—ä¸Šé¢åšä»»ä½•æ“ä½œ(è®¡ç®—ã€å‡½æ•°)ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆè€Œè½¬å‘å…¨è¡¨æ‰«æ** 
  ```sql
    select * from doc where YEAR(create_time) <= '2016'; --ä¼˜åŒ–å‰`
    select * from doc where create_time <= '2016-01-01'; --ä¼˜åŒ–å
  ```
- **å¼ºåˆ¶ç±»å‹è½¬æ¢ä¼šå…¨è¡¨æ‰«æ** 
  ```sql
    select * from doc where YEAR(create_time) <= '2016'; --ä¼˜åŒ–å‰
    select * from doc where create_time <= '2016-01-01'; --ä¼˜åŒ–å
  ```
- **æ›´æ–°ååˆ†é¢‘ç¹ã€æ•°æ®åŒºåˆ†åº¦ä¸é«˜çš„åˆ—ä¸å®œå»ºç«‹ç´¢å¼•** 
  - æ›´æ–°ä¼šå˜æ›´ B+ æ ‘ï¼Œæ›´æ–°é¢‘ç¹çš„å­—æ®µå»ºç«‹ç´¢å¼•ä¼šå¤§å¤§é™ä½æ•°æ®åº“æ€§èƒ½
  - "æ€§åˆ«"è¿™ç§åŒºåˆ†åº¦ä¸å¤§çš„å±æ€§ï¼Œå»ºç«‹ç´¢å¼•æ˜¯æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰çš„ï¼Œä¸èƒ½æœ‰æ•ˆè¿‡æ»¤æ•°æ®ï¼Œæ€§èƒ½ä¸å…¨è¡¨æ‰«æç±»ä¼¼
  - ä¸€èˆ¬åŒºåˆ†åº¦åœ¨ 80% ä»¥ä¸Šçš„æ—¶å€™å°±å¯ä»¥å»ºç«‹ç´¢å¼•ï¼ŒåŒºåˆ†åº¦å¯ä»¥ä½¿ç”¨  **count(distinct(åˆ—å)) / count(*)**  æ¥è®¡ç®—
- **åˆ©ç”¨è¦†ç›–ç´¢å¼•æ¥è¿›è¡ŒæŸ¥è¯¢æ“ä½œï¼Œé¿å…å›è¡¨ï¼Œå‡å°‘ select * çš„ä½¿ç”¨** 
  - **è¦†ç›–ç´¢å¼•**ï¼šæŸ¥è¯¢çš„åˆ—å’Œæ‰€å»ºç«‹çš„ç´¢å¼•çš„åˆ—ä¸ªæ•°ç›¸åŒï¼Œå­—æ®µç›¸åŒ
  - **è¢«æŸ¥è¯¢çš„åˆ—**ï¼šæ•°æ®èƒ½ä»ç´¢å¼•ä¸­å–å¾—ï¼Œè€Œä¸ç”¨é€šè¿‡è¡Œå®šä½ç¬¦ row-locator å†åˆ° row ä¸Šè·å–ï¼Œå³â€œè¢«æŸ¥è¯¢åˆ—è¦è¢«æ‰€å»ºçš„ç´¢å¼•è¦†ç›–â€ï¼Œè¿™èƒ½å¤ŸåŠ é€ŸæŸ¥è¯¢é€Ÿåº¦
  - å¯ä»¥å»ºç«‹ (login_name, passwd, login_time) çš„è”åˆç´¢å¼•ï¼Œç”±äº login_time å·²ç»å»ºç«‹åœ¨ç´¢å¼•ä¸­äº†ï¼Œè¢«æŸ¥è¯¢çš„ uid å’Œ login_time å°±ä¸ç”¨å» row ä¸Šè·å–æ•°æ®äº†ï¼Œä»è€ŒåŠ é€ŸæŸ¥è¯¢
  ```sql
    select uid, login_time 
    from user 
    where login_name=? and passwd=?;
  ```
- **ç´¢å¼•ä¸ä¼šåŒ…å«æœ‰ NULL å€¼çš„åˆ—ï¼ŒIS NULLï¼ŒIS NOT  NULL æ— æ³•ä½¿ç”¨ç´¢å¼•** 
  - **åªè¦åˆ—ä¸­åŒ…å«æœ‰ NULL å€¼éƒ½å°†ä¸ä¼šè¢«åŒ…å«åœ¨ç´¢å¼•ä¸­**ï¼Œå¤åˆç´¢å¼•ä¸­åªè¦æœ‰ä¸€åˆ—å«æœ‰ NULL å€¼ï¼Œé‚£ä¹ˆè¿™ä¸€åˆ—å¯¹äºæ­¤å¤åˆç´¢å¼•å°±æ˜¯æ— æ•ˆçš„ã€‚æ‰€ä»¥åœ¨æ•°æ®åº“è®¾è®¡æ—¶ï¼Œå°½é‡ä½¿ç”¨ NOT NULL çº¦æŸä»¥åŠé»˜è®¤å€¼
- **å¦‚æœæœ‰ order byã€group by çš„åœºæ™¯ï¼Œåˆ©ç”¨ç´¢å¼•çš„æœ‰åºæ€§** 
  - order by æœ€åçš„å­—æ®µæ˜¯ç»„åˆç´¢å¼•çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”æ”¾åœ¨ç´¢å¼•ç»„åˆé¡ºåºçš„æœ€åï¼Œé¿å…å‡ºç° file_sort çš„æƒ…å†µï¼Œå½±å“æŸ¥è¯¢æ€§èƒ½
- **ä½¿ç”¨çŸ­ç´¢å¼•(å‰ç¼€ç´¢å¼•)** 
  - å¯¹åˆ—è¿›è¡Œç´¢å¼•ï¼Œå¦‚æœå¯èƒ½åº”è¯¥ **æŒ‡å®šä¸€ä¸ªå‰ç¼€é•¿åº¦**ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ª CHAR(255) çš„åˆ—ï¼Œå¦‚æœè¯¥åˆ—åœ¨å‰ 10 ä¸ªæˆ– 20 ä¸ªå­—ç¬¦å†…ï¼Œå¯ä»¥åšåˆ°æ—¢ä½¿å¾—å‰ç¼€ç´¢å¼•çš„åŒºåˆ†åº¦æ¥è¿‘å…¨åˆ—ç´¢å¼•ï¼Œé‚£ä¹ˆå°± **ä¸è¦å¯¹æ•´ä¸ªåˆ—è¿›è¡Œç´¢å¼•**ã€‚å› ä¸ºçŸ­ç´¢å¼•ä¸ä»…å¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦è€Œä¸”å¯ä»¥èŠ‚çœç¡¬ç›˜ç©ºé—´å’Œ I/O æ“ä½œï¼Œå‡å°‘ç´¢å¼•æ–‡ä»¶çš„ç»´æŠ¤å¼€é”€ã€‚å¯ä»¥ä½¿ç”¨  **count(distinct leftIndex(åˆ—å, ç´¢å¼•é•¿åº¦)) / count(*)**  æ¥è®¡ç®—å‰ç¼€ç´¢å¼•çš„åŒºåˆ†åº¦
  - ç¼ºç‚¹æ˜¯ä¸èƒ½ç”¨äº ORDER BY å’Œ GROUP BY æ“ä½œï¼Œä¹Ÿä¸èƒ½ç”¨äºè¦†ç›–ç´¢å¼•
  - å¾ˆå¤šæ—¶å€™æ²¡å¿…è¦å¯¹å…¨å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œæ ¹æ®å®é™…æ–‡æœ¬åŒºåˆ†åº¦å†³å®šç´¢å¼•é•¿åº¦å³å¯
- **åˆ©ç”¨å»¶è¿Ÿå…³è”æˆ–è€…å­æŸ¥è¯¢ä¼˜åŒ–è¶…å¤šåˆ†é¡µåœºæ™¯** 
  - MySQL å¹¶ä¸æ˜¯è·³è¿‡ offset è¡Œï¼Œè€Œæ˜¯å–  **offset + N**  è¡Œï¼Œç„¶åè¿”å›æ”¾å¼ƒå‰ offset è¡Œï¼Œè¿”å› N è¡Œï¼Œé‚£å½“ offset ç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œæ•ˆç‡å°±éå¸¸çš„ä½ä¸‹ï¼Œè¦ä¹ˆæ§åˆ¶è¿”å›çš„æ€»é¡µæ•°ï¼Œè¦ä¹ˆå¯¹è¶…è¿‡ç‰¹å®šé˜ˆå€¼çš„é¡µæ•°è¿›è¡Œ SQL æ”¹å†™
- **å¦‚æœæ˜ç¡®çŸ¥é“åªæœ‰ä¸€æ¡ç»“æœè¿”å›ï¼Œlimit 1 èƒ½å¤Ÿæé«˜æ•ˆç‡** 
  ```sql
    select * from user where login_name=?;
    // å¯ä»¥ä¼˜åŒ–ä¸º
    select * from user where login_name=? limit 1
  ```
- **è¶…è¿‡ä¸‰ä¸ªè¡¨æœ€å¥½ä¸è¦ join** 
  - éœ€è¦ join çš„å­—æ®µï¼Œæ•°æ®ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œå¤šè¡¨å…³è”æŸ¥è¯¢æ—¶ï¼Œä¿è¯è¢«å…³è”çš„å­—æ®µéœ€è¦æœ‰ç´¢å¼•
  - ä¾‹å¦‚ï¼šleft join æ˜¯ç”±å·¦è¾¹å†³å®šçš„ï¼Œå·¦è¾¹çš„æ•°æ®ä¸€å®šéƒ½æœ‰ï¼Œæ‰€ä»¥å³è¾¹æ˜¯æˆ‘ä»¬çš„å…³é”®ç‚¹ï¼Œå»ºç«‹ç´¢å¼•è¦å»ºå³è¾¹çš„ã€‚å½“ç„¶å¦‚æœç´¢å¼•åœ¨å·¦è¾¹ï¼Œå¯ä»¥ç”¨ right join
- **å•è¡¨ç´¢å¼•å»ºè®®æ§åˆ¶åœ¨ 5 ä¸ªä»¥å†…** 
- **SQL æ€§èƒ½ä¼˜åŒ– explain ä¸­çš„ typeï¼šè‡³å°‘è¦è¾¾åˆ° range çº§åˆ«ï¼Œè¦æ±‚æ˜¯ ref çº§åˆ«ï¼Œå¦‚æœå¯ä»¥æ˜¯ consts æœ€å¥½** 
  - **consts**ï¼šå•è¡¨ä¸­æœ€å¤šåªæœ‰ä¸€ä¸ªåŒ¹é…è¡Œ(ä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•)ï¼Œåœ¨ä¼˜åŒ–é˜¶æ®µå³å¯è¯»å–åˆ°æ•°æ®
  - **ref**ï¼šä½¿ç”¨æ™®é€šçš„ç´¢å¼•(Normal Index)
  - **range**ï¼šå¯¹ç´¢å¼•è¿›è¡ŒèŒƒå›´æ£€ç´¢
  - **å½“ type = index æ—¶**ï¼šç´¢å¼•ç‰©ç†æ–‡ä»¶å…¨æ‰«ï¼Œé€Ÿåº¦éå¸¸æ…¢
- **ä¸šåŠ¡ä¸Šå…·æœ‰å”¯ä¸€ç‰¹æ€§çš„å­—æ®µï¼Œå³ä½¿æ˜¯å¤šä¸ªå­—æ®µçš„ç»„åˆï¼Œä¹Ÿå¿…é¡»å»ºæˆå”¯ä¸€ç´¢å¼•** 
  - ä¸è¦ä»¥ä¸ºå”¯ä¸€ç´¢å¼•å½±å“äº† insert é€Ÿåº¦ï¼Œè¿™ä¸ªé€Ÿåº¦æŸè€—å¯ä»¥å¿½ç•¥ï¼Œä½†æé«˜æŸ¥æ‰¾é€Ÿåº¦æ˜¯æ˜æ˜¾çš„

## WHERE è¯­å¥ç´¢å¼•ä½¿ç”¨çš„æ³¨æ„äº‹é¡¹ï¼Ÿ

- **where å­å¥ä½¿ç”¨çš„æ‰€æœ‰å­—æ®µï¼Œéƒ½å¿…é¡»å»ºç«‹ç´¢å¼•** 
- ç¡®ä¿  **MySQL ç‰ˆæœ¬ 5.0 ä»¥ä¸Š**ï¼Œä¸”æŸ¥è¯¢ä¼˜åŒ–å™¨ **å¼€å¯äº† index_merge_union = on**ï¼Œä¹Ÿå°±æ˜¯å˜é‡ optimizer_switch é‡Œå­˜åœ¨ index_merge_union ä¸”ä¸º on

## ç´¢å¼•ä»€ä¹ˆæ—¶å€™ä¼šå¤±æ•ˆï¼Ÿ

- æŸ¥è¯¢æ¡ä»¶ä¸­ **å¸¦æœ‰ or**ï¼Œé™¤éæ‰€æœ‰çš„æŸ¥è¯¢æ¡ä»¶éƒ½å»ºæœ‰ç´¢å¼•ï¼Œ
- **like æŸ¥è¯¢æ˜¯ä»¥ % å¼€å¤´**ï¼Œç´¢å¼•ä¼šå¤±æ•ˆ
- å¦‚æœåˆ—ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­éœ€è¦å°†æ•°æ®ç”¨å¼•å·å¼•ç”¨èµ·æ¥ï¼Œå¦åˆ™ç´¢å¼•å¤±æ•ˆ
- ç´¢å¼•åˆ—ä¸Šå‚ä¸è®¡ç®—ï¼Œç´¢å¼•å¤±æ•ˆ
- **è¿èƒŒæœ€å·¦åŒ¹é…åŸåˆ™**ï¼Œç´¢å¼•å¤±æ•ˆ
- å¦‚æœ  **MySQL ä¼°è®¡å…¨è¡¨æ‰«æè¦æ¯”ä½¿ç”¨ç´¢å¼•è¦å¿«**ï¼Œç´¢å¼•å¤±æ•ˆ

