---
statistics: true
comments: true
---

<style>
body {
  position: relative; /* ç¡®ä¿ body å…ƒç´ çš„ position å±æ€§ä¸ºéé™æ€å€¼ */
}

body::before {
  --size: 35px; /* è°ƒæ•´ç½‘æ ¼å•å…ƒå¤§å° */
  --line: color-mix(in hsl, canvasText, transparent 60%); /* è°ƒæ•´çº¿æ¡é€æ˜åº¦ */
  content: '';
  height: 100vh;
  width: 100%;
  position: absolute; /* ä¿®æ”¹ä¸º absolute ä»¥ä½¿å…¶éšé¡µé¢æ»šåŠ¨ */
  background: linear-gradient(
        90deg,
        var(--line) 1px,
        transparent 1px var(--size)
      )
      50% 50% / var(--size) var(--size),
    linear-gradient(var(--line) 1px, transparent 1px var(--size)) 50% 50% /
      var(--size) var(--size);
  -webkit-mask: linear-gradient(-20deg, transparent 30%, white 80%);
          mask: linear-gradient(-20deg, transparent 30%, white 80%);
  top: 0;
  transform-style: flat;
  pointer-events: none;
  z-index: -1;
}

@media (max-width: 768px) {
  body::before {
    display: none; /* åœ¨æ‰‹æœºç«¯éšè—ç½‘æ ¼æ•ˆæœ */
  }
}
</style>

# ğŸŸ¢ é”

## MySQL çš„å…¨å±€é”æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ

- **ä½œç”¨**ï¼šè®©æ•´ä¸ªæ•°æ®åº“å¤„äº **åªè¯»çŠ¶æ€**ï¼Œå¢åˆ æ”¹ä¼šè¢«é˜»å¡
- **ä½¿ç”¨åœºæ™¯**ï¼šå…¨å±€é” **ä¸»è¦åº”ç”¨äºåšå…¨åº“é€»è¾‘å¤‡ä»½**ï¼Œä¸ä¼šå› ä¸ºæ•°æ®æˆ–è¡¨ç»“æ„çš„æ›´æ–°è€Œå‡ºç°å¤‡ä»½æ–‡ä»¶çš„æ•°æ®ä¸é¢„æœŸçš„ä¸ä¸€æ ·
- **ç¼ºé™·**ï¼šæ•°æ®åº“é‡Œæœ‰å¾ˆå¤šæ•°æ®ï¼Œå¤‡ä»½ä¼šèŠ±è´¹å¾ˆå¤šçš„æ—¶é—´ã€‚å¤‡ä»½æœŸé—´ï¼Œä¸šåŠ¡ **åªèƒ½è¯»æ•°æ®è€Œä¸èƒ½æ›´æ–°æ•°æ®**ï¼Œè¿™æ ·ä¼šé€ æˆä¸šåŠ¡åœæ»
- **æ”¹è¿›**ï¼šå¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«ã€‚åœ¨å¤‡ä»½æ•°æ®åº“ä¹‹å‰å…ˆå¼€å¯äº‹åŠ¡ï¼Œä¼šå…ˆåˆ›å»º Read Viewï¼Œç„¶åæ•´ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´éƒ½åœ¨ç”¨è¿™ä¸ª Read Viewï¼Œè€Œä¸”ç”±äº MVCC çš„æ”¯æŒï¼Œå¤‡ä»½æœŸé—´ä¸šåŠ¡ä¾ç„¶å¯ä»¥å¯¹æ•°æ®è¿›è¡Œæ›´æ–°æ“ä½œã€‚å³ä½¿å…¶ä»–äº‹åŠ¡æ›´æ–°äº†è¡¨çš„æ•°æ®ï¼Œä¹Ÿä¸ä¼šå½±å“å¤‡ä»½æ•°æ®åº“æ—¶çš„ Read Viewï¼Œè¿™æ ·å¤‡ä»½æœŸé—´å¤‡ä»½çš„æ•°æ®ä¸€ç›´æ˜¯åœ¨å¼€å¯äº‹åŠ¡æ—¶çš„æ•°æ®

## MySQL çš„è¡¨çº§é”æœ‰å“ªäº›ï¼Ÿä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

### å…ƒæ•°æ®é”

- **ä½œç”¨**ï¼šå¯¹æ•°æ®åº“è¡¨è¿›è¡Œæ“ä½œæ—¶ **è‡ªåŠ¨** ç»™è¿™ä¸ªè¡¨åŠ ä¸Šå…ƒæ•°æ®é”ã€‚å¯ä»¥ä¿è¯å½“ç”¨æˆ·å¯¹è¡¨æ‰§è¡Œ CRUD æ“ä½œæ—¶å…¶ä»–çº¿ç¨‹å¯¹è¿™ä¸ªè¡¨ç»“æ„åšäº†å˜æ›´ã€‚å…ƒæ•°æ®é”åœ¨äº‹åŠ¡æäº¤åæ‰ä¼šé‡Šæ”¾

### æ„å‘é”

 **ä½œç”¨**ï¼šå¯¹æŸäº›è®°å½•åŠ ä¸Šã€Œå…±äº«é”ã€ä¹‹å‰ï¼Œéœ€è¦å…ˆåœ¨è¡¨çº§åˆ«åŠ ä¸Šä¸€ä¸ªã€Œæ„å‘å…±äº«é”ã€ï¼Œå¯¹æŸäº›è®°å½•åŠ ä¸Šã€Œç‹¬å é”ã€ä¹‹å‰ï¼Œéœ€è¦å…ˆåœ¨è¡¨çº§åˆ«åŠ ä¸Šä¸€ä¸ªã€Œæ„å‘ç‹¬å é”ã€ã€‚æ™®é€šçš„ select æ˜¯ä¸ä¼šåŠ è¡Œçº§é”çš„ï¼Œæ™®é€šçš„ select è¯­å¥æ˜¯åˆ©ç”¨ MVCC å®ç°ä¸€è‡´æ€§è¯»ï¼Œæ˜¯æ— é”çš„
- æ„å‘å…±äº«é”å’Œæ„å‘ç‹¬å é”æ˜¯è¡¨çº§é”ï¼Œä¸ä¼šå’Œè¡Œçº§çš„å…±äº«é”å’Œç‹¬å é”å‘ç”Ÿå†²çªï¼Œæ„å‘é”ä¹‹é—´ä¹Ÿä¸ä¼šå‘ç”Ÿå†²çªï¼Œåªä¼šå’Œå…±äº«è¡¨é”å’Œç‹¬å è¡¨é”å‘ç”Ÿå†²çªã€‚æ„å‘é”çš„ç›®çš„æ˜¯ä¸ºäº†å¿«é€Ÿåˆ¤æ–­è¡¨é‡Œæ˜¯å¦æœ‰è®°å½•è¢«åŠ é”

>  **Tips** 
> 
>  **select ä¹Ÿæ˜¯å¯ä»¥å¯¹è®°å½•åŠ å…±äº«é”å’Œç‹¬å é”çš„** 

### AUTO-INC é”

- **ä½œç”¨**ï¼šè¡¨é‡Œçš„ä¸»é”®é€šå¸¸åœ¨è®¾ç½®æˆè‡ªå¢åå¯ä»¥åœ¨æ’å…¥æ•°æ®æ—¶ä¸æŒ‡å®šä¸»é”®çš„å€¼ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨ç»™ä¸»é”®é€’å¢èµ‹å€¼ã€‚ **é€’å¢å€¼æ˜¯é€šè¿‡ AUTO-INC é”å®ç°çš„**ã€‚åœ¨æ’å…¥æ•°æ®æ—¶ä¼šåŠ ä¸€ä¸ªè¡¨çº§åˆ«çš„ AUTO-INC é”å¹¶å°† AUTO_INCREMENT ä¿®é¥°çš„å­—æ®µé€’å¢èµ‹å€¼ï¼Œç­‰æ’å…¥è¯­å¥æ‰§è¡Œå®Œæˆåæ‰ä¼šæŠŠ AUTO-INC é”é‡Šæ”¾æ‰ã€‚åœ¨æ­¤æœŸé—´å…¶ä»–äº‹åŠ¡å‘è¯¥è¡¨æ’å…¥è¯­å¥éƒ½ä¼šè¢«é˜»å¡ï¼Œä»è€Œä¿è¯æ’å…¥æ•°æ®æ—¶å­—æ®µçš„å€¼æ˜¯è¿ç»­é€’å¢çš„
- **ç¼ºé™·**ï¼šå¯¹å¤§é‡æ•°æ®è¿›è¡Œæ’å…¥çš„æ—¶ä¼šå½±å“æ’å…¥æ€§èƒ½ï¼Œå› ä¸ºå…¶ä»–äº‹åŠ¡ä¸­çš„æ’å…¥ä¼šè¢«é˜»å¡
- **æ”¹è¿›**ï¼šInnoDB å­˜å‚¨å¼•æ“æä¾›äº†ä¸€ç§è½»é‡çº§çš„é”æ¥å®ç°è‡ªå¢ã€‚åœ¨æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œä¼šä¸ºè¢« AUTO_INCREMENT ä¿®é¥°çš„å­—æ®µåŠ ä¸Šè½»é‡çº§é”ï¼Œç„¶åç»™è¯¥å­—æ®µèµ‹å€¼ä¸€ä¸ªè‡ªå¢çš„å€¼ï¼Œå°±æŠŠè¿™ä¸ªè½»é‡çº§é”é‡Šæ”¾äº†ï¼Œè€Œä¸éœ€è¦ç­‰å¾…æ•´ä¸ªæ’å…¥è¯­å¥æ‰§è¡Œå®Œåæ‰é‡Šæ”¾é”

>  **AUTO-INC é”æ§åˆ¶** 
> è®¾ç½® innodb_autoinc_lock_mode çš„ç³»ç»Ÿå˜é‡ï¼Œæ˜¯ç”¨æ¥æ§åˆ¶é€‰æ‹©ç”¨ AUTO-INC é”
> - å½“ innodb_autoinc_lock_mode = 0ï¼Œé‡‡ç”¨ AUTO-INC é”ï¼Œè¯­å¥æ‰§è¡Œç»“æŸåæ‰é‡Šæ”¾é”
> - å½“ innodb_autoinc_lock_mode = 2ï¼Œé‡‡ç”¨è½»é‡çº§é”ï¼Œç”³è¯·è‡ªå¢ä¸»é”®åå°±é‡Šæ”¾é”ï¼Œå¹¶ä¸éœ€è¦ç­‰è¯­å¥æ‰§è¡Œåæ‰é‡Šæ”¾
> - å½“ innodb_autoinc_lock_mode = 1
>   - æ™®é€š insert è¯­å¥ï¼Œè‡ªå¢é”åœ¨ç”³è¯·ä¹‹åå°±é©¬ä¸Šé‡Šæ”¾
>   - ç±»ä¼¼ insert â€¦ select è¿™æ ·çš„æ‰¹é‡æ’å…¥æ•°æ®çš„è¯­å¥ï¼Œè‡ªå¢é”è¦ç­‰è¯­å¥ç»“æŸåæ‰è¢«é‡Šæ”¾
> 
>  **innodb_autoinc_lock_mode = 2 æ˜¯æ€§èƒ½æœ€é«˜çš„æ–¹å¼**ï¼Œä½†æ˜¯å½“æ­é… binlog çš„æ—¥å¿—æ ¼å¼æ˜¯ statement æ—¶ï¼Œåœ¨ä¸»ä»å¤åˆ¶çš„åœºæ™¯ä¸­ä¼šå‘ç”Ÿ **æ•°æ®ä¸ä¸€è‡´** çš„é—®é¢˜
> 
> binlog æ—¥å¿—æ ¼å¼è¦è®¾ç½®ä¸º rowï¼Œè¿™æ ·åœ¨ binlog é‡Œé¢è®°å½•çš„æ˜¯ä¸»åº“åˆ†é…çš„è‡ªå¢å€¼ã€‚åˆ°å¤‡åº“æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸»åº“çš„è‡ªå¢å€¼æ˜¯ä»€ä¹ˆï¼Œä»åº“çš„è‡ªå¢å€¼å°±æ˜¯ä»€ä¹ˆ
> 
> æ‰€ä»¥ï¼Œå½“  **innodb_autoinc_lock_mode = 2 å¹¶ä¸” binlog_format = row**  æ—¶æ—¢èƒ½æå‡å¹¶å‘æ€§ï¼Œåˆä¸ä¼šå‡ºç°æ•°æ®ä¸€è‡´æ€§é—®é¢˜

## MySQL çš„è¡Œçº§é”æœ‰å“ªäº›ï¼Ÿä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

### è®°å½•é”(Record Lock)

- **ä½œç”¨**ï¼šé”ä½çš„æ˜¯ä¸€æ¡è®°å½•ï¼Œè®°å½•é”åˆ†ä¸º **å…±äº«é”(S é”)** å’Œ **æ’ä»–é”(X é”)**ã€‚å…¶ä¸­ S é”ä¹‹é—´ä¸äº’æ–¥

### é—´éš™é”(Gap Lock)

- **ä½œç”¨**ï¼šåªå­˜åœ¨äºå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼Œç›®çš„æ˜¯ä¸ºäº† **è§£å†³å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¹»è¯»çš„ç°è±¡**ã€‚é—´éš™é”ä¹‹é—´æ˜¯å…¼å®¹çš„ï¼Œä¸¤ä¸ªäº‹åŠ¡å¯ä»¥åŒæ—¶æŒæœ‰åŒ…å«å…±åŒé—´éš™èŒƒå›´çš„é—´éš™é”ï¼Œå¹¶ä¸å­˜åœ¨äº’æ–¥å…³ç³»

### ä¸´é”®é”(Next-Key Lock)

 **Next-Key Lock**  ä¸´é”®é”æ˜¯  **Record Lock + Gap Lock çš„ç»„åˆ** 
- **ä½œç”¨**ï¼šé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚next-key lock æ—¢èƒ½ä¿æŠ¤è¯¥è®°å½•ï¼Œåˆèƒ½é˜»æ­¢å…¶ä»–äº‹åŠ¡å°†æ–°çºªå½•æ’å…¥åˆ°è¢«ä¿æŠ¤è®°å½•å‰é¢çš„é—´éš™ä¸­ï¼Œå½¢æˆ **å·¦å¼€å³é—­** å¾—æ’å…¥ä¿æŠ¤åŒºé—´

### æ’å…¥æ„å‘é”

ä¸€ä¸ªäº‹åŠ¡åœ¨æ’å…¥ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œéœ€è¦åˆ¤æ–­æ’å…¥ä½ç½®æ˜¯å¦å·²è¢«å…¶ä»–äº‹åŠ¡åŠ äº†é—´éš™é”(next-key lock ä¹ŸåŒ…å«é—´éš™é”)ã€‚å¦‚æœæœ‰çš„è¯ï¼Œæ’å…¥æ“ä½œå°±ä¼šå‘ç”Ÿé˜»å¡ï¼Œç›´åˆ°æ‹¥æœ‰é—´éš™é”çš„é‚£ä¸ªäº‹åŠ¡æäº¤ä¸ºæ­¢ï¼Œåœ¨æ­¤æœŸé—´ä¼šç”Ÿæˆä¸€ä¸ªæ’å…¥æ„å‘é”ï¼Œè¡¨æ˜æœ‰äº‹åŠ¡æƒ³åœ¨æŸä¸ªåŒºé—´æ’å…¥æ–°è®°å½•ï¼Œä½†æ˜¯ç°åœ¨å¤„äºç­‰å¾…çŠ¶æ€ã€‚

## MySQL å¦‚ä½•åŠ é”

### å”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢

- å½“æŸ¥è¯¢çš„è®°å½• **å­˜åœ¨**ï¼Œåœ¨ç´¢å¼•æ ‘ä¸Šå®šä½åˆ°å¯¹åº”è®°å½•åï¼Œå°†è¯¥è®°å½•çš„  **next-key lock**  é€€åŒ–æˆ **è®°å½•é”** 
- å½“æŸ¥è¯¢çš„è®°å½• **ä¸å­˜åœ¨**ï¼Œåœ¨ç´¢å¼•æ ‘ä¸Šå®šä½åˆ°ç¬¬ä¸€æ¡å¤§äºè¯¥æŸ¥è¯¢çš„è®°å½•åï¼Œå°†è¯¥è®°å½•çš„  **next-key lock**  é€€åŒ–æˆé—´éš™é”

### éå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢

- å½“æŸ¥è¯¢çš„è®°å½• **å­˜åœ¨**ï¼Œç”±äºä¸æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œæ‰€ä»¥æœ‰å¯èƒ½å­˜åœ¨ç´¢å¼•å€¼ç›¸åŒçš„è®°å½•ã€‚åœ¨æ‰«æçš„è¿‡ç¨‹ä¸­å¯¹æ‰«æåˆ°çš„äºŒçº§ç´¢å¼•è®°å½•åŠ   **next-key lock**ï¼›å¯¹äºç¬¬ä¸€ä¸ªä¸ç¬¦åˆæ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•é€€åŒ–æˆ **é—´éš™é”**ï¼›ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„è®°å½•çš„ä¸»é”®ç´¢å¼•åŠ  **è®°å½•é”** 
- å½“æŸ¥è¯¢çš„è®°å½• **ä¸å­˜åœ¨**ï¼Œæ‰«æçš„ç¬¬ä¸€æ¡ä¸ç¬¦åˆæ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•é€€åŒ–æˆ **é—´éš™é”**ï¼›å› ä¸ºä¸å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„æŸ¥è¯¢è®°å½•ï¼Œå› æ­¤ä¸ä¼šå¯¹ä¸»é”®ç´¢å¼•åŠ é”

### å”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢

- **å½“æŸ¥è¯¢æ¡ä»¶ä¸º >**ï¼šå¯¹å¤§äºå½“å‰æ¡ä»¶çš„æ‰€æœ‰ç´¢å¼•åŠ   **next-key lock**ï¼›å¯¹æœ€å¤§ç´¢å¼•åé¢çš„ä¼ªè®°å½•åŠ   **next-key lock**ã€‚ç›¸å½“äº **åœ¨åŒºé—´ (value, +âˆ) åŠ é”** 
- **å½“æŸ¥è¯¢æ¡ä»¶ä¸º â‰¥**ï¼šå¯¹ç­‰äºå½“å‰æ¡ä»¶çš„ç´¢å¼•åŠ  **è®°å½•é”**ï¼›å¯¹å¤§äºå½“å‰æ¡ä»¶çš„æ‰€æœ‰ç´¢å¼•åŠ   **next-key lock**ï¼›å¯¹æœ€å¤§ç´¢å¼•åé¢çš„ä¼ªè®°å½•åŠ   **next-key lock**ã€‚ç›¸å½“äº **åœ¨åŒºé—´ (value, +âˆ) åŠ é”** 
- **å½“æŸ¥è¯¢æ¡ä»¶ä¸º <**ï¼šå¯¹å°äºå½“å‰æ¡ä»¶çš„æ‰€æœ‰ç´¢å¼•åŠ   **next-key lock**ï¼›å¯¹ç¬¬ä¸€ä¸ªä¸æ»¡è¶³å°äºæ¡ä»¶çš„è®°å½•å·¦ç«¯åŠ   **é—´éš™é”**ã€‚ç›¸å½“äº **åœ¨åŒºé—´ (-âˆ, value) åŠ  next-key lockï¼›åœ¨åŒºé—´ (pre-value, value] åŠ é—´éš™é”** 
- **å½“æŸ¥è¯¢æ¡ä»¶ä¸º â‰¤**ï¼š
  - **å¦‚æœé™åˆ¶æ¡ä»¶å¯¹åº”çš„è®°å½•å­˜åœ¨**ï¼š **åœ¨åŒºé—´ (-âˆ, value] åŠ  next-key lock** 
  - **å¦‚æœé™åˆ¶æ¡ä»¶å¯¹åº”çš„è®°å½•ä¸å­˜åœ¨**ï¼šå¯¹å°äºå½“å‰æ¡ä»¶çš„æ‰€æœ‰ç´¢å¼•åŠ   **next-key lock**ï¼›å¯¹ç¬¬ä¸€ä¸ªä¸æ»¡è¶³å°äºæ¡ä»¶çš„è®°å½•å·¦ç«¯åŠ   **é—´éš™é”**ã€‚ç›¸å½“äº **åœ¨åŒºé—´ (-âˆ, value) åŠ  next-key lockï¼›åœ¨åŒºé—´ (pre-value, next-value) åŠ é—´éš™é”** 

### éå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢

- ç´¢å¼•çš„ next-key lock  **ä¸ä¼šæœ‰é€€åŒ–ä¸ºé—´éš™é”å’Œè®°å½•é”çš„æƒ…å†µ** 
- éå”¯ä¸€ç´¢å¼•è¿›è¡ŒèŒƒå›´æŸ¥è¯¢æ—¶ï¼Œå¯¹äºŒçº§ç´¢å¼•è®°å½•åŠ é” **éƒ½æ˜¯åŠ  next-key lock** 
